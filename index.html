<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz: Quel 4-roues pour votre enfant ?</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* --- Styles Généraux --- */
        :root {
            --red-500: #ef4444;
            --red-600: #dc2626;
            --green-500: #22c55e;
            --green-600: #16a34a;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #11182c;
            --white: #ffffff;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--gray-100);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
            margin: 0;
            color: var(--gray-800);
        }

        /* --- Conteneur Principal du Quiz --- */
        .quiz-container {
            background-color: var(--white);
            width: 100%;
            max-width: 42rem;
            margin: auto;
            border-radius: 1rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            padding: 1.5rem;
            transition: opacity 0.5s ease-in-out;
        }

        /* --- Barre de Progression --- */
        .progress-bar-container {
            width: 100%;
            background-color: var(--gray-200);
            border-radius: 9999px;
            height: 0.625rem;
            margin-bottom: 1.5rem;
        }

        .progress-bar {
            background-color: var(--red-500);
            height: 100%;
            border-radius: 9999px;
            transition: width 0.5s ease-in-out;
        }

        /* --- Écrans (Accueil, Question, Résultats) --- */
        .welcome-screen, .question-screen, .results-screen {
            text-align: center;
        }

        .welcome-icon {
            width: 4rem;
            height: 4rem;
            margin: 0 auto 1rem auto;
            color: var(--red-500);
        }

        h1 {
            font-size: 1.875rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 2rem;
        }
        
        .results-screen h2 {
            font-size: 1.875rem;
            margin-bottom: 1rem;
        }

        .welcome-screen p {
            color: var(--gray-600);
            margin-bottom: 2rem;
        }
        
        .results-screen .subtitle {
             color: var(--gray-600);
             margin-bottom: 2rem;
        }

        /* --- Boutons --- */
        button, a.button-like {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
        }
        
        button:hover, a.button-like:hover {
             transform: translateY(-2px);
        }

        .start-quiz-btn, .restart-quiz-btn, .result-link {
            color: var(--white);
            padding: 0.75rem 2rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .start-quiz-btn:hover, .restart-quiz-btn:hover, .result-link:hover {
            transform: scale(1.05);
        }

        .start-quiz-btn, .restart-quiz-btn {
            background-color: var(--red-500);
        }

        .start-quiz-btn:hover, .restart-quiz-btn:hover {
            background-color: var(--red-600);
        }
        
        .restart-quiz-btn {
            margin-top: 2rem;
            padding: 0.5rem 1.5rem;
        }

        .prev-btn {
            background-color: var(--gray-300);
            color: var(--gray-700);
            padding: 0.5rem 1.5rem;
        }

        .prev-btn:hover {
            background-color: var(--gray-400);
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }

        /* --- Options du Quiz --- */
        .options-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .option-btn {
            width: 100%;
            text-align: left;
            padding: 1rem;
            border: 2px solid var(--gray-300);
            border-radius: 0.5rem;
            background-color: var(--white);
            color: var(--gray-800);
            transition: background-color 0.2s, transform 0.2s, border-color 0.2s;
        }

        .option-btn:hover {
            background-color: #fee2e2; /* red-100 */
            border-color: #f87171; /* red-400 */
            transform: translateY(-2px);
        }

        .option-btn.selected {
            background-color: var(--red-600);
            color: white;
            border-color: var(--red-600);
        }

        /* --- Écran des Résultats --- */
        .result-content {
            background-color: #f9fafb; /* gray-50 */
            border: 1px solid var(--gray-200);
            border-radius: 0.75rem;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            text-align: left;
        }

        .result-image {
            width: 100%;
            height: auto;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .result-details {
            flex: 1;
        }

        .result-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
            margin: 0 0 0.5rem 0;
        }

        .result-description {
            color: var(--gray-700);
            margin-top: 0.5rem;
            margin-bottom: 1rem;
        }

        .result-features {
            list-style-type: disc;
            list-style-position: inside;
            color: var(--gray-600);
            padding-left: 0;
            margin-bottom: 1.5rem;
        }
        
        .result-features li {
            margin-bottom: 0.25rem;
        }

        .result-link {
            display: inline-block;
            text-decoration: none;
            background-color: var(--green-500);
        }
        
        .result-link:hover {
            background-color: var(--green-600);
        }

        /* --- Utilitaires --- */
        .hidden {
            display: none;
        }
        .fade-out {
            opacity: 0;
        }

        /* --- Styles pour écrans larges (Desktop) --- */
        @media (min-width: 768px) {
            .quiz-container {
                padding: 2.5rem;
            }
            h1 {
                font-size: 2.25rem;
            }
            .options-container {
                grid-template-columns: repeat(2, 1fr);
            }
            .result-content {
                flex-direction: row;
            }
            .result-image {
                width: 33.333333%;
            }
        }
    </style>
</head>
<body>

    <div id="quiz-container" class="quiz-container">

        <!-- Barre de progression -->
        <div id="progress-bar-container" class="progress-bar-container hidden">
            <div id="progress-bar" class="progress-bar" style="width: 0%;"></div>
        </div>

        <!-- Écran d'accueil -->
        <div id="welcome-screen" class="welcome-screen">
            <svg class="welcome-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.903-2.903L12 17.25l1.178-.398a3.375 3.375 0 002.903-2.903L16.5 12.75l.398 1.178a3.375 3.375 0 002.903 2.903L21 17.25l-1.178.398a3.375 3.375 0 00-2.903 2.903z" />
            </svg>
            <h1>Le 4-Roues Idéal Pour Votre Enfant</h1>
            <p>Répondez à quelques questions rapides pour trouver le modèle parfait qui fera le bonheur de votre petit pilote !</p>
            <button id="start-quiz-btn" class="start-quiz-btn">
                Commencer le Quiz
            </button>
        </div>

        <!-- Écran de question (Modèle) -->
        <div id="question-screen" class="question-screen hidden">
            <h2 id="question-title"></h2>
            <div id="options-container" class="options-container">
                <!-- Les options seront injectées ici -->
            </div>
            <div class="nav-buttons">
                <button id="prev-btn" class="prev-btn">Précédent</button>
                <!-- Le bouton Suivant est ajouté dynamiquement si nécessaire -->
            </div>
        </div>

        <!-- Écran des résultats -->
        <div id="results-screen" class="results-screen hidden">
            <h2>Voici notre recommandation !</h2>
            <p class="subtitle">D'après vos réponses, voici le 4-roues qui semble parfait pour votre aventurier.</p>
            
            <div id="result-content" class="result-content">
                <img id="result-image" src="" alt="Image du 4-roues recommandé" class="result-image">
                <div class="result-details">
                    <h3 id="result-name" class="result-name"></h3>
                    <p id="result-description" class="result-description"></p>
                    <ul id="result-features" class="result-features">
                        <!-- Les caractéristiques seront injectées ici -->
                    </ul>
                    <a id="result-link" href="#" target="_blank" class="result-link button-like">
                        Voir le produit
                    </a>
                </div>
            </div>

            <button id="restart-quiz-btn" class="restart-quiz-btn">
                Recommencer le Quiz
            </button>
        </div>
    </div>

    <script>
        // --- DONNÉES ---
        // C'est ici que vous définissez vos questions et les recommandations de produits.
        // Vous pouvez facilement personnaliser cette section.

        const quizData = [
            {
                question: "🎂 Quel âge a votre enfant ?",
                key: 'age',
                options: [
                    { text: "Moins de 4 ans", value: "0-3" },
                    { text: "4 à 8 ans", value: "4-8" },
                    { text: "8 à 12 ans", value: "8-12" },
                    { text: "12 ans et plus", value: "12+" }
                ],
                multiple: false
            },
            {
                question: "🏞️ Où le 4-roues sera-t-il le plus utilisé ?",
                key: 'terrain',
                options: [
                    { text: "Cour ou jardin (terrain plat)", value: "yard" },
                    { text: "Sentiers et chemins de terre", value: "trails" },
                    { text: "Terrains variés (boue, collines)", value: "varied" }
                ],
                multiple: false
            },
           {
                question: "✨ Quel look et design souhaitez-vous ?",
                key: 'look',
                options: [
                    { text: "Utilitaire (robuste, pratique)", value: "utility" },
                    { text: "Sport (rapide, racé)", value: "sport" },
                    { text: "Peu importe", value: "any" }
                ],
                multiple: false
            },
            { 
                question: "💰 Quel est votre budget ?",
                key: 'budget',
                options: [
                    { text: "Je veux le meilleur rapport QUALITÉ/PRIX", value: "low" },
                    { text: "Je veux le TOP du TOP", value: "high" }
                ],
                multiple: false
            }
        ];

        const productRecommendations = [
            //produit par défaut
            {
                id: 'Aucun',
                name: "Aucun modèle trouvé",
                description: "Nous n'avons pas réussi à déterminer avec précision quel modèle est le plus adapté.",
                link: "https://www.micperformance.com/pages/contact",
                image: "https://www.micperformance.com/cdn/shop/files/MICperf-rouge_f7df13b5-55af-4f83-aa9a-4cccc46b9566.png?v=1734639269&width=90",
                features: ["Il est important que les pieds de votre enfant touchent les repose-pieds.","Les 4 roues électriques ne sont pas compatibles avec la boue et l'eau."],
            },
            //4 roues électriques
            {
                id: 'Minitron',
                name: "VTT Minitron (eQuad S)",
                description: "Le point de départ parfait pour les plus jeunes. Facile à utiliser, sécuritaire et tellement amusant pour les premières aventures.",
                link: "https://www.micperformance.com/products/minitron", 
                image: "https://www.micperformance.com/cdn/shop/files/minitron-rose.jpg",
                features: ["36 Volts", "500 Watts", "Design coloré et attrayant", "Télécommande parentale", "Sélecteur 3 vitesses"],
                match: { age: ['0-3'], budget: ['low'], terrain: ['yard'], look: ['sport','any'] }
            },
            {
                id: 'Manteray',
                name: "VTT Manteray",
                description: "Le point de départ parfait pour les plus jeunes. Facile à utiliser, sécuritaire et tellement amusant pour les premières aventures.",
                link: "https://www.micperformance.com/products/manteray",
                image: "https://www.micperformance.com/cdn/shop/files/manteray-rouge.jpg",
                features: ["36 Volts", "500 Watts", "Design coloré et attrayant", "Sélecteur 3 vitesses"],
                match: { age: ['4-8'], budget: ['low'], terrain: ['yard', 'trails'], look: ['sport'] }
            },
            {
                id: 'Optimus',
                name: "2025 VTT Gio Optimus (eQuad X)",
                description: "Le point de départ parfait pour les plus jeunes. Facile à utiliser, sécuritaire et tellement amusant pour les premières aventures.",
                link: "https://www.micperformance.com/products/optimus",
                image: "https://www.micperformance.com/cdn/shop/files/optimus-rouge.jpg?v=1744219883",
                features: ["36 Volts", "800 Watts", "Télécommande parentale", "Sélecteur 3 vitesses"],
                match: { age: ['4-8'], budget: ['low'], terrain: ['yard', 'trails'], look: ['utility'] }
            },
            {
                id: 'Tornado',
                name: "VTT Tornado",
                description: "Le point de départ parfait pour les plus jeunes. Facile à utiliser, sécuritaire et tellement amusant pour les premières aventures.",
                link: "https://www.micperformance.com/products/vtt-tornado-800w",
                image: "https://www.micperformance.com/cdn/shop/files/Tornado_noir.png",
                features: ["36 Volts", "800 Watts", "Télécommande parentale", "Sélecteur 3 vitesses"],
                match: { age: ['4-8'], budget: ['high'], terrain: ['yard', 'trails'], look: ['sport'] }
            },
            {
                id: 'Torpedo',
                name: "VTT Torpedo",
                description: "Le point de départ parfait pour les plus jeunes. Facile à utiliser, sécuritaire et tellement amusant pour les premières aventures.",
                link: "https://www.micperformance.com/products/vtt-gio-torpedo",
                image: "https://www.micperformance.com/cdn/shop/files/VTTTORPEDOORANGE.webp?v=1744139774",
                features: ["48 Volts", "1000 Watts", "Télécommande parentale", "Sélecteur 3 vitesses"],
                match: { age: ['4-8','8-12'], budget: ['low', 'high'], terrain: ['yard', 'trails'], look: ['utility'] }
            },
            {
                id: 'Devastator',
                name: "2025 VTT Gio Devastator (eQuad Q)",
                description: "Le point de départ parfait pour les plus jeunes. Facile à utiliser, sécuritaire et tellement amusant pour les premières aventures.",
                link: "https://www.micperformance.com/products/gio-devastator",
                image: "https://www.micperformance.com/cdn/shop/files/Devastator-bleu.jpg?v=1744313141",
                features: ["48 Volts", "1200 Watts", "Télécommande parentale", "Sélecteur 3 vitesses"],
                match: { age: ['4-8','8-12'], budget: ['low','high'], terrain: ['yard', 'trails'], look: ['sport'] }
            },
            {
                id: 'Juventus',
                name: "VTT JUVENTUS",
                description: "Facile à utiliser et tellement amusant",
                link: "https://www.micperformance.com/products/vtt-juventus",
                image: "https://www.micperformance.com/cdn/shop/files/vtt-juventus-vert-_4.jpg?v=1743695199",
                features: ["60 Volts", "1000 Watts", "Vitesse Max 32km/h"],
                match: { age: ['12+'], budget: ['low','high'], terrain: ['yard', 'trails'], look: ['sport'] }
            },
            {
                id: 'Megatronpr',
                name: "VTT Megatron Premium",
                description: "Facile à utiliser et tellement amusant",
                link: "https://www.micperformance.com/products/vtt-megatron-premium",
                image: "https://www.micperformance.com/cdn/shop/files/megatron-premium-noir.jpg",
                features: ["60 Volts", "1500 Watts", "Vitesse Max 32km/h"],
                match: { age: ['12+'], budget: ['low','high'], terrain: ['yard', 'trails'], look: ['utility'] }
            },
            // 4 roues essences
            {
                id: '110B',
                name: "VTT 110B",
                description: "Le point de départ parfait pour les plus jeunes. Facile à utiliser, sécuritaire et tellement amusant pour les premières aventures.",
                link: "https://www.micperformance.com/products/vtt-110b",
                image: "https://www.micperformance.com/cdn/shop/files/VTT-110B-BLEU-SPIDERMAN.jpg?v=1749134017",
                features: ["Moteur 4 temps, 110 cc", "Automatique", "Télécommande parentale"],
                match: { age: ['4-8'], budget: ['low'], terrain: ['varied'], look: ['sport'] }
            },
            {
                id: '110P',
                name: "VTT 110P",
                description: "Le point de départ parfait pour les plus jeunes. Facile à utiliser, sécuritaire et tellement amusant pour les premières aventures.",
                link: "https://www.micperformance.com/products/gio-110p-2",
                image: "https://www.micperformance.com/cdn/shop/files/110P-BATMAN.jpg?v=1750341557",
                features: ["Moteur 4 temps, 110 cc", "Automatique + Reculon", "Télécommande parentale"],
                match: { age: ['4-8'], budget: ['high'], terrain: ['varied'], look: ['sport'] }
            },
            {
                id: '110H',
                name: "VTT 110H",
                description: "Le point de départ parfait pour les plus jeunes. Facile à utiliser et tellement amusant pour les premières aventures.",
                link: "https://www.micperformance.com/products/110h",
                image: "https://www.micperformance.com/cdn/shop/files/BLAZER_110H_ROUGE_3.png?v=1743696048",
                features: ["Moteur 4 temps, 110 cc", "Automatique + Reculon", "Suspensions et Échappement améliorés"],
                match: { age: ['8-12'], budget: ['low','high'], terrain: ['varied'], look: ['sport'] }
            },
            {
                id: '125D',
                name: "VTT 125D",
                description: "Facile à utiliser, sécuritaire et tellement amusant.",
                link: "https://www.micperformance.com/products/125d",
                image: "https://www.micperformance.com/cdn/shop/files/125D-BLEU-SPIDER.jpg?v=1747928578",
                features: ["Moteur 4 temps, 125 cc", "Automatique + Reculon", "Télécommande parentale"],
                match: { age: ['12+'], budget: ['low'], terrain: ['varied'], look: ['utility'] }
            },
            {
                id: '125P',
                name: "VTT 125P",
                description: "Facile à utiliser, sécuritaire et tellement amusant.",
                link: "https://www.micperformance.com/products/vtt-blazer-125p",
                image: "https://www.micperformance.com/cdn/shop/files/125P-bleu.jpg?v=1745587586",
                features: ["Moteur 4 temps, 125 cc", "SEMI-Automatique + Reculon", "Télécommande parentale"],
                match: { age: ['12+'], budget: ['high'], terrain: ['varied'], look: ['utility'] }
            },
            {
                id: '125S',
                name: "VTT 125S",
                description: "Facile à utiliser et tellement amusant.",
                link: "https://www.micperformance.com/products/125s",
                image: "https://www.micperformance.com/cdn/shop/files/vtt-125s-bleu.jpg?v=1743696055",
                features: ["Moteur 4 temps, 125 cc", "Automatique + Reculon", "Suspensions et Échappement améliorés"],
                match: { age: ['12+'], budget: ['low','high'], terrain: ['varied'], look: ['sport'] }
            },
            {
                id: '125HS',
                name: "VTT 125HS PREMIUM",
                description: "Facile à utiliser, sécuritaire et tellement amusant.",
                link: "https://www.micperformance.com/products/vtt-125hs-premium",
                image: "https://www.micperformance.com/cdn/shop/files/vtt-125hs-prem-ora-_1.jpg?v=1746473619",
                features: ["Moteur 4 temps, 125 cc", "Automatique + Reculon", "Suspensions et Échappement améliorés"],
                match: { age: ['12+'], budget: ['high'], terrain: ['varied'], look: ['any'] }
            },
        ];

        // --- LOGIQUE DU QUIZ ---

        const startBtn = document.getElementById('start-quiz-btn');
        const restartBtn = document.getElementById('restart-quiz-btn');
        const prevBtn = document.getElementById('prev-btn');
        
        const welcomeScreen = document.getElementById('welcome-screen');
        const questionScreen = document.getElementById('question-screen');
        const resultsScreen = document.getElementById('results-screen');
        
        const questionTitle = document.getElementById('question-title');
        const optionsContainer = document.getElementById('options-container');
        
        const progressBarContainer = document.getElementById('progress-bar-container');
        const progressBar = document.getElementById('progress-bar');

        let currentQuestionIndex = 0;
        let userAnswers = {};

        function startQuiz() {
            currentQuestionIndex = 0;
            userAnswers = {};
            welcomeScreen.classList.add('fade-out');
            setTimeout(() => {
                welcomeScreen.classList.add('hidden');
                welcomeScreen.classList.remove('fade-out');
                questionScreen.classList.remove('hidden');
                progressBarContainer.classList.remove('hidden');
                displayQuestion();
            }, 300);
        }

        function displayQuestion() {
            const questionData = quizData[currentQuestionIndex];
            
            // Mettre à jour la barre de progression
            const progress = ((currentQuestionIndex) / quizData.length) * 100;
            progressBar.style.width = `${progress}%`;

            questionTitle.textContent = questionData.question;
            optionsContainer.innerHTML = '';

            questionData.options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option.text;
                button.dataset.value = option.value;
                button.className = 'option-btn';
                
                // Vérifier si cette option a été précédemment sélectionnée
                if (userAnswers[questionData.key] === option.value) {
                    button.classList.add('selected');
                }

                button.onclick = () => selectOption(option.value, questionData.key);
                optionsContainer.appendChild(button);
            });

            prevBtn.style.visibility = currentQuestionIndex > 0 ? 'visible' : 'hidden';
        }

        function selectOption(value, key) {
            userAnswers[key] = value;
            
            // Mettre à jour les styles des boutons
            document.querySelectorAll('#options-container .option-btn').forEach(btn => {
                if (btn.dataset.value === value) {
                    btn.classList.add('selected');
                } else {
                    btn.classList.remove('selected');
                }
            });

            // Passer automatiquement à la question suivante après un court délai
            setTimeout(() => {
                if (currentQuestionIndex < quizData.length - 1) {
                    currentQuestionIndex++;
                    displayQuestion();
                } else {
                    showResults();
                }
            }, 300);
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function showResults() {
            // Mettre à jour la barre de progression à 100%
            progressBar.style.width = `100%`;

            questionScreen.classList.add('fade-out');
            setTimeout(() => {
                questionScreen.classList.add('hidden');
                questionScreen.classList.remove('fade-out');
                resultsScreen.classList.remove('hidden');
                
                const recommendation = calculateRecommendation();
                displayRecommendation(recommendation);
            }, 300);
        }

        function calculateRecommendation() {
            let scores = {};
            productRecommendations.forEach(prod => scores[prod.id] = 0);

            productRecommendations.forEach(product => {
                // On s'assure que le produit a des critères de correspondance avant de calculer le score.
                // Cela évite une erreur avec le produit "Aucun" qui n'a pas de 'match'.
                if (product.match) {
                    if (product.match.age.includes(userAnswers.age)) scores[product.id] += 5;
                    if (product.match.budget.includes(userAnswers.budget)) scores[product.id] += 2;
                    if (product.match.terrain.includes(userAnswers.terrain)) scores[product.id] += 5;
                    if (product.match.look.includes(userAnswers.look)) scores[product.id] += 1;
                    
                }
            });

            // On retire le produit 'Aucun' de la liste des candidats pour ne pas le sélectionner comme "meilleur".
            const candidateIds = Object.keys(scores).filter(id => id !== 'Aucun');

            // S'il n'y a aucun candidat (par ex. si la liste de produits est vide sauf pour "Aucun")
            if (candidateIds.length === 0) {
                return productRecommendations.find(p => p.id === 'Aucun');
            }

            let bestMatchId = candidateIds.reduce((a, b) => scores[a] > scores[b] ? a : b);
            
            // Solution de repli vers une valeur par défaut si aucune bonne correspondance n'est trouvée
            if(scores[bestMatchId] < 11) {
                return productRecommendations.find(p => p.id === 'Aucun');
            }

            return productRecommendations.find(p => p.id === bestMatchId);
        }

        function displayRecommendation(product) {
            document.getElementById('result-image').src = product.image;
            document.getElementById('result-image').alt = `Image de ${product.name}`;
            document.getElementById('result-name').textContent = product.name;
            document.getElementById('result-description').textContent = product.description;

            const baseUrl = product.link;
            const utmParams = `utm_source=quiz-vehicule&utm_medium=quiz&utm_campaign=recommandation-produit&utm_content=resultat-${product.id}`;
            const finalUrl = baseUrl.includes('?') ? `${baseUrl}&${utmParams}` : `${baseUrl}?${utmParams}`;
            document.getElementById('result-link').href = finalUrl;
            
            const featuresList = document.getElementById('result-features');
            featuresList.innerHTML = '';
            product.features.forEach(feature => {
                const li = document.createElement('li');
                li.textContent = feature;
                featuresList.appendChild(li);
            });
        }

        function restartQuiz() {
            resultsScreen.classList.add('hidden');
            progressBarContainer.classList.add('hidden');
            progressBar.style.width = '0%';
            welcomeScreen.classList.remove('hidden');
        }

        // --- ÉCOUTEURS D'ÉVÉNEMENTS ---
        startBtn.addEventListener('click', startQuiz);
        restartBtn.addEventListener('click', restartQuiz);
        prevBtn.addEventListener('click', prevQuestion);

    </script>

</body>
</html>
